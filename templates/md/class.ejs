<%
/**
 * Copyright 2017 Adobe Systems Incorporated. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 */
function isRequired(key,requiredProperties) {
	
	if( _.indexOf(requiredProperties,key,0) != -1 )
		return "_Required_";
	else
		return "";
}
function createLink(str,link){
  return "[" + str + "](" + link+ ")";
}
function getType(valueObject) {
var type=valueObject.type;

switch(type){
case "anyOf":{ var str="";

								var curObj=valueObject["anyOf"];
								_.each(curObj,function(obj,index){
									if(index != (curObj.length - 1) )
										str = str + getType(obj) + "|" ;
									else
										str = str + getType(obj) ;
									});
								return str;
								}
								break;
case "array":{
					var items=valueObject["items"];
					var str="";
					if(items.properties)
						return "Array of Object Containing following Properties" + NestedProperties(items);
					if(valueObject["items"]){
						var str=getType(valueObject["items"])
							return str+"[]";
					}

				}
				break;
case "oneOf":{ 	var str="This property can be one of following values  \n";
								var curObj=valueObject["oneOf"];
								_.each(curObj,function(obj,index){
									if(index != (curObj.length - 1) )
										str = str + getType(obj) + "|" ;
									else
										str = str + getType(obj) ;
									});
								return str;
					}

case "allOf":{ 	var str="This property can be all of following values  \n";
													var curObj=valueObject["allOf"];
													_.each(curObj,function(obj,index){
														if(index != (curObj.length - 1) )
															str = str + getType(obj) + "|" ;
														else
															str = str + getType(obj) ;
														});
													return str;
						}

}

  if(valueObject["$linkPath"]){
    return createLink("`" + valueObject["type"] + "`",valueObject["$linkPath"]);
  }
  else{
    if( valueObject["format"])
      return "`"+valueObject["format"]+"`";
    else{
      if(valueObject["type"])
        return "`"+valueObject["type"]+"`";
    }

  }
      return "";

}
function NestedProperties(valueObj){
  if(valueObj["properties"] && Object.keys(valueObj["properties"]).length > 0){

    var string="\n#### **Properties**\n";
    _.forOwn(valueObj["properties"], function (value,prop) {
      if(value["description"])
        description=value["description"];
      else
        description="";
  string=string + "*  **"+linkProperty(prop)+"** "+getType(value)
  +"  \n"+description+"\n\n";

  });
  return string;
  }
	return "";
}

function displayEnum(valueObj){
  if(valueObj["enum"]){
    enumArray = valueObj["enum"];
  var str="\n\n *x âˆˆ  {";
  _.each(enumArray,function(item,index){
    if(index != (enumArray.length - 1) )
      str=str+item+",";
    else
      str=str+item+"}*\n ";

  });
  return str;
  }
  return "";
}

function linkProperty(str){
  if(validUrl.isUri(str)){
    arr=str.split("/");
    text=arr[arr.length - 1 ];
    return createLink(text,str);
  }
  else
    return str;
}

function displayDefinitions(obj){
	var str="## Definitions\n\n";
	_.forOwn(obj, function (value,prop) {
		str=str+"### "+prop+":\n\n"+getType(value)+"\n\n"+displayEnum(value)+NestedProperties(value);
	});

return str;

}

function displayExamples(obj){
	var str="";
	if(obj.examples){
		str="### Examples\n\n";
		_.each(obj.examples, function (item) {
			var temp=JSON.stringify(item,null, 4);
			str=str+"```json\n"+temp+"\n```\n\n";
		});
	}

	return str;
}%>
<% if(Object.keys(schema.metaElements).length > 0){ %>
---<% _.forOwn(schema.metaElements, function (value,key) { %>
<%- key %> : <%- value %><% }); %>
---<% } %>
# <%- schema["title"] %>

<%- schema["description"] %>
## Properties

<%- getType(schema) %>
<% _.forOwn(schema.properties, function (value,prop) { %>

###  <%- linkProperty(prop) %>
<%- getType(value) %> <%- isRequired(prop,schema["required"]) %>

<%- value["description"] %><%- displayEnum(value) %><%- NestedProperties(value)  %>
<% }); %>

<% if(schema["definitions"]) { %>

<%- displayDefinitions(schema["definitions"]) %>
<% } %>
<%- displayExamples(schema) %>
